<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        img{
            display: block;
        }
    </style>
</head>
<body>
    <header>
        <h2>Demo</h2>
    </header>
    <div>
        <img src="./img/house-6967908_640.jpg" alt="dog-img" id="dogImg">
    </div>
    <div>
        <input type="range" id="range" min="-255" max="255" value="0">
        <button type="button" id="init">초기화</button>
    </div>
    <script src="../src/psm.js"></script>
    <script>

        var img = document.querySelector('#dogImg'),
        range = document.getElementById('range'),
        psmFilter = new psm.Filter()

        psmFilter.env({ 
            setting: { 
                format: 'image/jpeg', 
                return: 'toBlob'
            }, 
            link: img
        }).then(result => {
            console.log('이미지가 연결되었습니다.')
        })
        
        function filter(red){
            // psmFilter.set('convolute', { 
            //     weights: 
            //     [ 0, -1, 0,
            //     -1, 5, -1,
            //     0, -1, 0 ],
            //     opaque: 0
            // })

            // psmFilter.set('sobel')

            // psmFilter.set('edgeDetection')
            psmFilter.set('blur', { radius: 5 })
            // psmFilter.set('embossImage')

            // psmFilter.set('sharpen')

            // psmFilter.set('binary', { 
            //   threshold: 0.2
            // })

            // psmFilter.set('saturation', { 
            //     red: Number(red)
            // })

            // psmFilter.set('contrast', { 
            //     value: 32
            // })

            // psmFilter.set('sepia')

            // psmFilter.set('brightness', { 
            //     value: 0
            // })

            // psmFilter.set('invert')

            // psmFilter.set('grayscale')

            if(img.complete){
                psmFilter.apply(img)
                .then(function(url){
                    img.src = url
                })
            }else{
                img.addEventListener('load', function(){
                    img.src = psmFilter.apply(img)
                }, { once: true })
            }
        }

        range.addEventListener('input', function(){
            console.time('filter')
            filter(range.value)
            console.timeEnd('filter')
        })

        var init = document.getElementById('init')
        init.addEventListener('click', function(){
            psmFilter.set('init')
            psmFilter.apply().then(function(url){
                img.src = url
            })
        })

    </script>
</body>
</html>